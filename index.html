<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–î–æ 26 –¥–µ–∫–∞–±—Ä—è 2025</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#121a2b;
      --edge:#1c2842;
      --text:#eaf2ff;
      --muted:#97a2bf;
      --accent:#70b8ff;
      --accent-2:#ff8fb6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,
      "Noto Sans","Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 0%, #0e1830 0, var(--bg) 60%),
                  radial-gradient(800px 400px at 80% 20%, #0e1830 0, var(--bg) 60%), var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    header{ text-align:center; padding:40px 16px 8px; line-height:1.2; }
    h1{ margin:0; font-size:clamp(1.4rem, 3.5vw, 2.2rem); font-weight:800; letter-spacing:.3px }
    .sub{ margin-top:6px; color:var(--muted); font-size:clamp(.9rem, 2.2vw, 1rem) }

    .wrap{ max-width:1024px; margin:0 auto; padding:12px 16px 56px }

    .timer{
      display:grid; grid-template-columns:repeat(4, minmax(130px, 1fr)); gap:14px;
      align-items:stretch; margin-top:18px;
    }
    .unit{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.08)), var(--card);
      border:1px solid var(--edge); border-radius:18px; padding:18px 16px; text-align:center;
      box-shadow:0 30px 50px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);
      position:relative; overflow:hidden;
    }
    .unit::after{
      content:""; position:absolute; inset:0; background:linear-gradient(180deg, rgba(255,255,255,.04), transparent 40%);
      pointer-events:none;
    }
    .label{ color:var(--muted); font-weight:600; font-size:.92rem; letter-spacing:.32px; text-transform:uppercase }
    .value{
      font-variant-numeric:tabular-nums slashed-zero; line-height:1;
      margin-top:10px; font-weight:900; letter-spacing:.5px;
      font-size:clamp(2.4rem, 9vw, 4.4rem);
      text-shadow:0 6px 22px rgba(0,0,0,.45);
    }

    .controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; margin-top:18px}
    .btn{
      appearance:none; border:1px solid var(--edge); color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.08));
      padding:10px 14px; border-radius:12px; font-weight:700; cursor:pointer; transition:.2s transform, .2s filter, .2s background;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .hint{color:var(--muted); text-align:center; margin-top:6px; font-size:.92rem}

    #fx{position:fixed; inset:0; opacity:0; pointer-events:none; transition:opacity .35s ease; display:block; z-index:50;}
    #fx.show{opacity:1}
    #fxBack{ position:fixed; inset:0; background:radial-gradient(1000px 500px at 50% 60%, rgba(255,255,255,.05), rgba(0,0,0,.7));
      opacity:0; pointer-events:none; transition:opacity .35s ease; z-index:49;}
    #fxBack.show{opacity:1}

    #overlay{
      position:fixed; inset:0; display:grid; place-items:center;
      background:rgba(0,0,0,.6);
      opacity:0; pointer-events:none; transition:opacity .35s ease; z-index:60;
    }
    #overlay.show{ opacity:1; pointer-events:auto; }
    #overlay img, #overlay #ovText{
      display:none; max-width:min(90vw, 640px); max-height:80vh;
    }
    #overlay .visible{ display:block; animation:pop .35s ease; }
    #ovText{ font-size:clamp(3rem, 12vw, 8rem); font-weight:900; color:#fff; text-shadow:0 4px 30px rgba(0,0,0,.6); }
    @keyframes pop{ 0%{transform:scale(.9);opacity:.001} 100%{transform:scale(1);opacity:1} }

    @media (max-width: 640px){ .timer{grid-template-columns:repeat(2, minmax(130px,1fr))} }
  
  /* —É—Å–∏–ª–µ–Ω–Ω–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ "–û–π" –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤–µ—Ä—Ö —Å–∞–ª—é—Ç–∞ */
  #ovText{ display:none; }
  #overlay #ovText.visible{
    display:block;
    font-size:min(18vw, 180px);
    line-height:1;
    font-weight:900;
    color:#fff;
    text-transform:uppercase;
    text-shadow:0 6px 20px rgba(0,0,0,.9), 0 0 40px rgba(255,255,255,.35);
    -webkit-text-stroke:4px rgba(0,0,0,.45);
    letter-spacing:.04em; padding:.1em .2em; border-radius:16px;
  }
</style>
</head>
<body>
  <header>
    <h1>–í—Ä–µ–º—è –¥–æ <span id="targetLabel">26 –¥–µ–∫–∞–±—Ä—è 2025</span></h1>
    <div class="sub"></div>
  </header>

  <div class="wrap">
    <section class="timer" role="timer" aria-live="polite" aria-atomic="true">
      <article class="unit" aria-label="–î–Ω–∏">
        <div class="label">–î–Ω–∏</div>
        <div class="value" id="d">00</div>
      </article>
      <article class="unit" aria-label="–ß–∞—Å—ã">
        <div class="label">–ß–∞—Å—ã</div>
        <div class="value" id="h">00</div>
      </article>
      <article class="unit" aria-label="–ú–∏–Ω—É—Ç—ã">
        <div class="label">–ú–∏–Ω—É—Ç—ã</div>
        <div class="value" id="m">00</div>
      </article>
      <article class="unit" aria-label="–°–µ–∫—É–Ω–¥—ã">
        <div class="label">–°–µ–∫—É–Ω–¥—ã</div>
        <div class="value" id="s">00</div>
      </article>
    </section>

    <div class="controls">
      <button class="btn" id="soundBtn" aria-pressed="false" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">üîá –ó–≤—É–∫ –≤—ã–∫–ª.</button>
    </div>
    <div class="hint"></div>
  </div>

  <div id="fxBack" aria-hidden="true"></div>
  <canvas id="fx" aria-hidden="true"></canvas>

  <div id="overlay" aria-hidden="true">
    <img id="ovImg1" src="img1.jpg" alt="–ü–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞" />
    <div id="ovText">–æ–π</div>
    <img id="ovImg2" src="img2.jpg" alt="–í—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞" />
  </div>

  <!-- üéµ –î–æ—Ä–æ–∂–∫–∞ —Ñ–∏–Ω–∞–ª–∞; –ø–æ–ª–æ–∂–∏—Ç–µ song.mp3 —Ä—è–¥–æ–º —Å —ç—Ç–∏–º HTML -->
  <audio id="finalSong" src="song.mp3" preload="auto" loop></audio>

<script>
(function(){
  // ====== –§–∏–∫—Å–∏—Ä—É–µ–º —Ü–µ–ª—å –Ω–∞ 1 –Ω–æ—è–±—Ä—è 2025 00:00 (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±—Ä–∞—É–∑–µ—Ä–∞) ======
  const TARGET = new Date(2025, 11, 27, 0, 0, 0, 0);
  const targetLabel = document.getElementById('targetLabel');
  targetLabel.textContent = '27 –¥–µ–∫–∞–±—Ä—è 2025';

  const dom = { d: document.getElementById('d'), h: document.getElementById('h'), m: document.getElementById('m'), s: document.getElementById('s') };
  const pad2 = n => String(n).padStart(2,'0');
  let prevDays = null;

  let endedFired = false; // –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑
  let holdZeroUntil = 0;  // —É–¥–µ—Ä–∂–∏–≤–∞–µ–º –Ω—É–ª–∏, –ø–æ–∫–∞ –∏–¥—ë—Ç –ø–æ–∫–∞–∑ –æ–≤–µ—Ä–ª–µ—è

  function compute(){
    const now = new Date();

    if (!endedFired && now >= TARGET){
      endedFired = true;
      holdZeroUntil = now.getTime() + 4800;

      // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –Ω—É–ª–∏
      dom.d.textContent = '00';
      dom.h.textContent = '00';
      dom.m.textContent = '00';
      dom.s.textContent = '00';

      endSequence();
      // –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ–º –∑–∞–ø—É—Å–∫ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —Ç–∏–∫, —á—Ç–æ–±—ã –æ–±—ä–µ–∫—Ç fireworks —É—Å–ø–µ–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è
      setTimeout(() => triggerFireworks(Infinity), 0);
    }

    // –ü–æ—Å–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ —Ç–∞–π–º–µ—Ä –ù–ï –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
    let diff;
    if (Date.now() < holdZeroUntil){
      diff = 0;
    } else {
      diff = Math.max(0, TARGET - now);
    }

    const totalSec = Math.floor(diff / 1000);
    const days = Math.floor(totalSec / 86400);
    const hours = Math.floor((totalSec % 86400) / 3600);
    const mins = Math.floor((totalSec % 3600) / 60);
    const secs = totalSec % 60;

    dom.d.textContent = pad2(days);
    dom.h.textContent = pad2(hours);
    dom.m.textContent = pad2(mins);
    dom.s.textContent = pad2(secs);

    if (prevDays !== null && days !== prevDays && totalSec > 0) {
      triggerFireworks(10_000);
    }
    prevDays = days;
  }
  compute();
  setInterval(compute, 250);

  // ====== –ê—É–¥–∏–æ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (Web Audio) ======
  let audioCtx = null;
  let audioEnabled = false;

  function ensureAudio(){
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }

  function playWhistle(duration = 0.9){
    if (!audioEnabled) return;
    ensureAudio();
    const ctx = audioCtx;
    const t0  = ctx.currentTime;

    const osc    = ctx.createOscillator();
    const filter = ctx.createBiquadFilter();
    const gain   = ctx.createGain();
    const panner = (ctx.createStereoPanner ? ctx.createStereoPanner() : null);

    const hissBuf = ctx.createBuffer(1, Math.floor(ctx.sampleRate * duration), ctx.sampleRate);
    const hiss    = ctx.createBufferSource(); hiss.buffer = hissBuf;
    const hissF   = ctx.createBiquadFilter(); hissF.type = 'bandpass';
    const hissG   = ctx.createGain();

    const ch = hissBuf.getChannelData(0);
    for (let i=0;i<ch.length;i++){
      const t = i / hissBuf.sampleRate;
      ch[i] = (Math.random()*2 - 1) * (1 - t);
    }

    const lfo     = ctx.createOscillator();
    const lfoGain = ctx.createGain();

    gain.gain.setValueAtTime(0.0001, t0);
    gain.gain.exponentialRampToValueAtTime(0.22, t0 + 0.06);
    gain.gain.exponentialRampToValueAtTime(0.0001, t0 + duration);

    osc.connect(filter).connect(gain);
    if (panner){ gain.connect(panner); panner.connect(ctx.destination); }
    else { gain.connect(ctx.destination); }

    hiss.connect(hissF).connect(hissG).connect(ctx.destination);

    const S = { wave:'triangle', f0: 800+Math.random()*150, f1: 1900+Math.random()*450, vibHz:6.5, vibAmtHz:18, q:14, fil0:1100, fil1:2800, hiss:0.03 };

    osc.type = S.wave;
    osc.frequency.setValueAtTime(S.f0, t0);
    osc.frequency.exponentialRampToValueAtTime(S.f1, t0 + duration * 0.9);

    filter.type = 'bandpass';
    filter.Q.setValueAtTime(S.q, t0);
    filter.frequency.setValueAtTime(S.fil0, t0);
    filter.frequency.exponentialRampToValueAtTime(S.fil1, t0 + duration * 0.9);

    lfo.frequency.setValueAtTime(S.vibHz, t0);
    const lfoGainNode = ctx.createGain();
    lfoGainNode.gain.setValueAtTime(18, t0);
    lfo.connect(lfoGainNode).connect(osc.frequency);
    lfo.start(t0); lfo.stop(t0 + duration);

    hissF.frequency.setValueAtTime((S.f0+S.f1)/2, t0);
    hissF.Q.setValueAtTime(S.q*0.8, t0);
    hissG.gain.setValueAtTime(S.hiss, t0);
    hiss.start(t0); hiss.stop(t0 + duration);

    if (panner) panner.pan.setValueAtTime((Math.random()*2 - 1) * 0.25, t0);

    osc.start(t0);    osc.stop(t0 + duration);
  }

  function playExplosion(){
    if (!audioEnabled) return;
    ensureAudio();
    const ctx = audioCtx; const t0 = ctx.currentTime;

    const boomOsc = ctx.createOscillator();
    const boomGain = ctx.createGain();
    boomOsc.type = 'sine';
    boomOsc.frequency.setValueAtTime(90, t0);
    boomOsc.frequency.exponentialRampToValueAtTime(45, t0 + 1.0);
    boomGain.gain.setValueAtTime(0.6, t0);
    boomGain.gain.exponentialRampToValueAtTime(0.001, t0 + 1.2);
    boomOsc.connect(boomGain).connect(ctx.destination);
    boomOsc.start(t0); boomOsc.stop(t0 + 1.3);

    const buffer = ctx.createBuffer(1, ctx.sampleRate * 2, ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) {
      data[i] = (Math.random() * 2 - 1) * (1 - i / data.length);
    }
    const noise = ctx.createBufferSource(); noise.buffer = buffer;
    const band = ctx.createBiquadFilter(); band.type = 'bandpass'; band.frequency.setValueAtTime(2200, t0);
    const nGain = ctx.createGain();
    nGain.gain.setValueAtTime(0.001, t0);
    nGain.gain.exponentialRampToValueAtTime(0.8, t0 + 0.05);
    nGain.gain.exponentialRampToValueAtTime(0.0001, t0 + 1.4);
    noise.connect(band).connect(nGain).connect(ctx.destination);
    noise.start(t0); noise.stop(t0 + 1.5);

    for (let k = 0; k < 6; k++) {
      playCrackle(t0 + 0.2 + Math.random() * 0.6);
    }
  }

  function playCrackle(atTime){
    if (!audioEnabled) return;
    ensureAudio();
    const ctx = audioCtx;
    const dur = 0.15;
    const buffer = ctx.createBuffer(1, Math.floor(ctx.sampleRate * dur), ctx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) {
      const t = i / buffer.sampleRate;
      data[i] = (Math.random() * 2 - 1) * Math.pow(1 - t, 2) * (Math.random() > 0.8 ? 1.0 : 0.6);
    }
    const src = ctx.createBufferSource(); src.buffer = buffer;
    const g = ctx.createGain(); g.gain.setValueAtTime(0.25, atTime); g.gain.exponentialRampToValueAtTime(0.001, atTime + dur);
    src.connect(g).connect(ctx.destination);
    src.start(atTime);
  }

  // ====== –ú—É–∑—ã–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–∞–ª—é—Ç–∞ (HTMLAudio) ======
  const finalSong = document.getElementById('finalSong');
  finalSong.volume = 0.85; // –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –ø–æ–º–µ–Ω—è–π—Ç–µ –≥—Ä–æ–º–∫–æ—Å—Ç—å (0..1)
  let songPrimed = false;

  function primeFinalSong(){
    if (songPrimed) return;
    try {
      // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à–µ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ ‚Äî –≤—ã–∑—ã–≤–∞–µ–º play() –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∫–ª–∏–∫
      finalSong.muted = true;
      finalSong.play().then(() => {
        finalSong.pause();
        finalSong.muted = false;
        finalSong.currentTime = 0;
        songPrimed = true;
      }).catch(() => {});
    } catch(e) {}
  }
  function playFinalSong(){
    if (!audioEnabled) return; // –ø–æ–¥—á–∏–Ω—è–µ–º—Å—è –æ–±—â–µ–π –∫–Ω–æ–ø–∫–µ –∑–≤—É–∫–∞
    try { finalSong.currentTime = 0; finalSong.play().catch(() => {}); } catch(e) {}
  }
  function stopFinalSong(){
    try { finalSong.pause(); } catch(e) {}
  }

  // ====== –í–∏–∑—É–∞–ª—å–Ω—ã–π —Å–∞–ª—é—Ç (Canvas) ======
  const canvas = document.getElementById('fx');
  const back = document.getElementById('fxBack');
  const ctx2d = canvas.getContext('2d');
  const DPR = Math.min(window.devicePixelRatio || 1, 2);

  function resizeCanvas(){
    const { innerWidth:w, innerHeight:h } = window;
    canvas.width = Math.floor(w * DPR);
    canvas.height = Math.floor(h * DPR);
    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    ctx2d.setTransform(DPR, 0, 0, DPR, 0, 0);
  }
  window.addEventListener('resize', resizeCanvas, { passive:true });
  resizeCanvas();

  const GRAVITY = 90;
  const AIR = 0.995;

  class Particle{
    constructor(x, y, angle, speed, color){
      this.x=x; this.y=y; this.vx=Math.cos(angle)*speed; this.vy=Math.sin(angle)*speed;
      this.alpha=1; this.life = 0.9 + Math.random()*0.6;
      this.color=color; this.size=1.4 + Math.random()*2.2; this.spark = Math.random() < 0.2;
    }
    update(dt){
      this.vy += GRAVITY * dt;
      this.vx *= AIR; this.vy *= AIR;
      this.x += this.vx * dt; this.y += this.vy * dt;
      this.alpha -= dt / this.life;
    }
    draw(ctx){
      if (this.alpha <= 0) return;
      ctx.globalAlpha = Math.max(0, this.alpha);
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
      ctx.fillStyle = this.color;
      ctx.fill();
      if (this.spark && Math.random() < 0.4){
        ctx.globalAlpha = Math.max(0, this.alpha*0.7);
        ctx.fillRect(this.x + (Math.random()-0.5)*6, this.y + (Math.random()-0.5)*6, 1.2, 1.2);
      }
      ctx.globalAlpha = 1;
    }
  }

  class Rocket{
    constructor(w, h){
      this.x = w*0.1 + Math.random()*w*0.8;
      this.y = h + 12;
      this.vx = (Math.random()-0.5)*40;
      this.vy = -(260 + Math.random()*220);
      this.targetY = h * (0.22 + Math.random()*0.4);
      this.exploded = false;
      this.trail = [];
      this.hue = Math.floor(Math.random()*360);
      this.color = `hsl(${this.hue} 100% 65%)`;
      this.swishPlayed = false;
    }
    update(dt){
      if (this.exploded) return;
      this.vy += 120 * dt;
      this.x += this.vx * dt; this.y += this.vy * dt;
      this.trail.push({x:this.x, y:this.y, a:1}); if (this.trail.length > 12) this.trail.shift();
      if (!this.swishPlayed){ playWhistle(0.9); this.swishPlayed = true; }
      if (this.vy > -40 || this.y <= this.targetY){ this.explode(); }
    }
    explode(){
      if (this.exploded) return; this.exploded = true;
      const count = 120 + Math.floor(Math.random()*80);
      for (let i=0;i<count;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 90 + Math.random()*260;
        fireworks.particles.push(new Particle(this.x, this.y, angle, speed, this.color));
      }
      for (let i=0;i<30;i++){
        const angle = Math.random()*Math.PI*2;
        const speed = 40 + Math.random()*80;
        fireworks.particles.push(new Particle(this.x, this.y, angle, speed, '#fff7d6'));
      }
      playExplosion();
    }
    draw(ctx){
      if (this.exploded) return;
      ctx.strokeStyle = this.color;
      ctx.lineWidth = 2;
      ctx.globalAlpha = .7;
      ctx.beginPath();
      for (let i=0;i<this.trail.length;i++){
        const t = this.trail[i]; i===0 ? ctx.moveTo(t.x, t.y) : ctx.lineTo(t.x, t.y);
      }
      ctx.stroke(); ctx.globalAlpha = 1;
      ctx.beginPath(); ctx.arc(this.x, this.y, 2.2, 0, Math.PI*2); ctx.fillStyle=this.color; ctx.fill();
    }
  }

  const fireworks = {
    running:false,
    rockets:[], particles:[], last:0, endAt:0,
    _failsafe: null,
    start(durationMs=10000){
      if (this.running) this.stop();
      this.running = true;
      back.classList.add('show'); canvas.classList.add('show');
      this.last = performance.now();
      this.endAt = (Number.isFinite(durationMs) ? this.last + durationMs : Infinity);
      if (Number.isFinite(durationMs)) {
        this._failsafe = setTimeout(() => { if (this.running) this.stop(); }, durationMs + 2000);
      } else {
        this._failsafe = null;
      }
      this.loop();
    },
    stop(){
      this.running = false;
      if (this._failsafe){ clearTimeout(this._failsafe); this._failsafe = null; }
      this.rockets.length = 0; this.particles.length = 0;
      back.classList.remove('show'); canvas.classList.remove('show');
      ctx2d.clearRect(0,0,canvas.width,canvas.height);
    },
    spawnRocket(){ this.rockets.push(new Rocket(canvas.width, canvas.height)); },
    loop(){
      if (!this.running) return;
      const now = performance.now();
      const dt = Math.min((now - this.last) / 1000, 0.035);
      this.last = now;

      ctx2d.fillStyle = 'rgba(0,0,0,.20)';
      ctx2d.fillRect(0,0,canvas.width,canvas.height);

      if (now < this.endAt) {
        if (Math.random() < 0.14) this.spawnRocket();
      }

      for (const r of this.rockets) { r.update(dt); r.draw(ctx2d); }
      this.rockets = this.rockets.filter(r => !r.exploded);

      ctx2d.globalCompositeOperation = 'lighter';
      for (const p of this.particles) { p.update(dt); p.draw(ctx2d); }
      ctx2d.globalCompositeOperation = 'source-over';
      this.particles = this.particles.filter(p => p.alpha > 0 && p.y < canvas.height + 80);

      if (now >= this.endAt && this.rockets.length === 0 && this.particles.length === 0) {
        this.stop(); return;
      }
      requestAnimationFrame(this.loop.bind(this));
    }
  };

  function triggerFireworks(ms){ fireworks.start(ms || 10_000); }

  const soundBtn = document.getElementById('soundBtn');
  soundBtn.addEventListener('click', async () => {
    if (!audioCtx) ensureAudio();
    if (audioCtx.state === 'suspended') await audioCtx.resume();
    audioEnabled = !audioEnabled;
    soundBtn.setAttribute('aria-pressed', String(audioEnabled));
    soundBtn.textContent = audioEnabled ? 'üîä –ó–≤—É–∫ –≤–∫–ª.' : 'üîá –ó–≤—É–∫ –≤—ã–∫–ª.';

    if (audioEnabled){
      // –†–∞–∑—Ä–µ—à–∏–º –¥–∞–ª—å–Ω–µ–π—à–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π —Å—Ç–∞—Ä—Ç –º—É–∑—ã–∫–∏ –∏ –≤–∫–ª—é—á–∏–º –µ—ë, –µ—Å–ª–∏ —Ñ–∏–Ω–∞–ª —É–∂–µ –∏–¥—ë—Ç
      primeFinalSong();
      if (endedFired) playFinalSong();
    } else {
      stopFinalSong();
    }
  });

  // ====== –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å "–∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Üí –æ–π ‚Üí –∫–∞—Ä—Ç–∏–Ω–∫–∞" ======
  const overlay = document.getElementById('overlay');
  const ovImg1  = document.getElementById('ovImg1');
  const ovImg2  = document.getElementById('ovImg2');
  const ovText  = document.getElementById('ovText');

  function endSequence(){
    const showOnly = (el) => {
      ovImg1.classList.remove('visible');
      ovImg2.classList.remove('visible');
      ovText.classList.remove('visible');
      if (el) el.classList.add('visible');
    };

    overlay.classList.add('show');

    // ‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç—É–µ–º –º—É–∑—ã–∫–∞–ª—å–Ω—É—é –¥–æ—Ä–æ–∂–∫—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Å–∞–ª—é—Ç—É
    if (audioEnabled) playFinalSong();

    // 1) –ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
    showOnly(ovImg1);
    setTimeout(() => { showOnly(null); }, 1400);

    // 2) "–æ–π"
    setTimeout(() => { showOnly(ovText); }, 1600);
    setTimeout(() => { showOnly(null); }, 3000);

    // 3) –≤—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
    setTimeout(() => { showOnly(ovImg2); }, 3200);

    // 4) –æ—Å—Ç–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞–≤—Å–µ–≥–¥–∞ ‚Äî –æ–≤–µ—Ä–ª–µ–π –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
}
})();
</script>
</body>
</html>
